// FileClientApp.java
package psp.ud03.act303.client;
import java.io.*;
import java.net.*;

public class FileClientApp {
    private static final String DEFAULT_HOST = "localhost";
    private static final int DEFAULT_PORT = 2121;

    public static void main(String[] args) {
        String host = DEFAULT_HOST;
        int port = DEFAULT_PORT;

        // Verificar argumentos de línea de comandos
        if (args.length >= 1) {
            host = args[0];
        }
        if (args.length >= 2) {
            port = Integer.parseInt(args[1]);
        }

        // Establecer conexión con el servidor
        try (Socket socket = new Socket(host, port);
             BufferedReader reader = new BufferedReader(new InputStreamReader(socket.getInputStream()));
             PrintWriter writer = new PrintWriter(socket.getOutputStream(), true);
             BufferedReader consoleReader = new BufferedReader(new InputStreamReader(System.in))
        ) {
            System.out.println("Conectado al servidor en " + host + ":" + port);
            String userInput;
            while ((userInput = consoleReader.readLine()) != null) {
                writer.println(userInput);
                String response;
                if ((response = reader.readLine()) != null) {
                    if (response.startsWith("OK")) {
                        if (!response.equals("OK quit")) {
                            String[] parts = response.split("\n", 3);
                            int linesCount = Integer.parseInt(parts[1]);
                            for (int i = 0; i < linesCount; i++) {
                                System.out.println(parts[2]);
                            }
                        }
                    } else {
                        System.out.println("Respuesta del servidor: " + response);
                    }
                    if (userInput.equalsIgnoreCase("quit")) {
                        break;
                    }
                } else {
                    System.out.println("No se recibió respuesta del servidor.");
                    break;
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}